(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{493:function(t,s,a){"use strict";a.r(s);var n=a(1),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("p",[t._v("本篇博客主要是对常见文件上传漏洞的总结")]),t._v(" "),s("h2",{attrs:{id:"一、原理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#一、原理"}},[t._v("#")]),t._v(" 一、原理")]),t._v(" "),s("p",[t._v("文件上传的表单：")]),t._v(" "),s("div",{staticClass:"language-haxe extra-class"},[s("pre",{pre:!0,attrs:{class:"language-haxe"}},[s("code",[t._v("\t            "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("h3"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("上传区"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("h3"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\t            "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("fom enctype"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"multipart/fom-data"')]),t._v(" method"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"post"')]),t._v(" onsubmit"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"return checkFile()"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//js函数验证")]),t._v("\n\t                "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("p"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("请选择要上传的图片："),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("p"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\t                "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("input "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"input_file"')]),t._v(" type"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"file"')]),t._v(" name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"upload_file"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\t                "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("input "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"button"')]),t._v(" type"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"submit"')]),t._v(" name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"submit"')]),t._v(" value"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"上传"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\t            "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("fom"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),s("blockquote",[s("p",[t._v("属性：")]),t._v(" "),s("div",{staticClass:"language-html extra-class"},[s("pre",{pre:!0,attrs:{class:"language-html"}},[s("code",[t._v('enctype="multipart/fom-data"\n'),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("br")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n在表单使用文件上传的功能时⬆\n")])])]),s("p",[s("img",{attrs:{src:"http://wangdengdeng.oss-cn-hangzhou.aliyuncs.com/img/image-20220323144318489.png",alt:"image-20220323144318489"}})])]),t._v(" "),s("h2",{attrs:{id:"二、题解"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#二、题解"}},[t._v("#")]),t._v(" 二、题解")]),t._v(" "),s("h3",{attrs:{id:"第一关"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#第一关"}},[t._v("#")]),t._v(" 第一关")]),t._v(" "),s("p",[t._v("就是简单的js验证，在查看源码后知道表单提交的文件通过js函数进行验证，所以给出了文件上传的第一步==尝试关闭js效果==，验证是否能够绕过。")]),t._v(" "),s("scrpt",{attrs:{type:"text/javascrpt"}},[t._v('\n    function checkFile() {\n        var file = document.getElementsByName(\'upload_file\')[0].value;//取得name属性的值进行验证\n        if (file == null || file == "") {\n            alert("请选择要上传的文件!");\n            return false;\n        }\n        //定义允许上传的文件类型\n        var allow_ext = ".jpg|.png|.gif"; //白名单\n        //提取上传文件的类型\n        var ext_name = file.substring(file.lastIndexOf("."));\n        //判断上传文件类型是否允许上传\n        if (allow_ext.indexOf(ext_name) == -1) {·\t\t//匹配\n            var errMsg = "该文件不允许上传，请上传" + allow_ext + "类型的文件,当前文件类型为：" + ext_name;\n            alert(errMsg);\n            return false;\n        }\n    }\n')]),t._v(" "),s("h3",{attrs:{id:"第二关"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#第二关"}},[t._v("#")]),t._v(" 第二关")]),t._v(" "),s("p",[t._v("对Content-type的验证，抓包绕过")]),t._v(" "),s("h3",{attrs:{id:"第三关"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#第三关"}},[t._v("#")]),t._v(" 第三关")]),t._v(" "),s("p",[t._v("黑名单：")]),t._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$deny_ext")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("array")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'.asp'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'.aspx'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'.php'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'.jsp'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("在httpd.conf的文件中可以直接指定某种对应的文件类型应该指向的文件后缀为？")]),t._v(" "),s("div",{staticClass:"language-html extra-class"},[s("pre",{pre:!0,attrs:{class:"language-html"}},[s("code",[t._v("AddType application/x-httpd-php .php .phtml .phps .php5 .pht\n")])])]),s("p",[t._v("即指向的php的文件后缀可以是**.php .phtml .phps .php5 .pht**")]),t._v(" "),s("p",[t._v("换言之，如果直接修改了配置文件，可以是任意的后缀都由php解析！")]),t._v(" "),s("p",[s("img",{attrs:{src:"http://wangdengdeng.oss-cn-hangzhou.aliyuncs.com/img/image-20220329211458388.png",alt:"image-20220329211458388"}})]),t._v(" "),s("p",[t._v("摘自万大侠的笔记，对于DefaultType的解释，但是自己去找的时候并没有这个配置，所以不再赘述，直接翻译为对于未知文件后缀的文件，apache大概率会直接作为文本文件输出，不再深入赘述")]),t._v(" "),s("h3",{attrs:{id:"第四关"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#第四关"}},[t._v("#")]),t._v(" 第四关")]),t._v(" "),s("p",[t._v("httpd.conf是总的配置文件，Apache还有一个新的特性——.htaccess文件")]),t._v(" "),s("p",[t._v("该文件类似每个站点独有的httpd.conf配置文件；.htaccess所在目录及其所在目录的所有子")]),t._v(" "),s("p",[t._v("目录都会受到影响")]),t._v(" "),s("p",[t._v("当然也有配置条件才能允许这个文件存在：")]),t._v(" "),s("p",[t._v("\\1. 总配置文件有AllowOverride All")]),t._v(" "),s("p",[t._v("\\2. 并且载入了LoadModule rewrite_module")]),t._v(" "),s("p",[t._v("/usr/lib/apache2/modules/mod_rewrite.so")]),t._v(" "),s("p",[t._v("\\3. Ubuntu中可能还得执行sudo a2enmod rewrite")]),t._v(" "),s("p",[t._v("\\4. 然后重启即可")]),t._v(" "),s("p",[t._v("对于==AllowOverride==的解释")]),t._v(" "),s("div",{staticClass:"language-html extra-class"},[s("pre",{pre:!0,attrs:{class:"language-html"}},[s("code",[t._v("AllowOverride参数就是指明Apache服务器是否去找.htacess文件作为配置文件，如果设置为none,那么服务器将忽略.htacess文件，如果设置为All,那么所有在.htaccess文件里有的指令都将被重写。对于AllowOverride，还可以对它指定如下一些能被重写的指令类型.\n")])])]),s("p",[t._v("对于==mod_rewrite==的解释")]),t._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[t._v("mod_rewrite模块可以操作"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("URL")]),t._v("的所有部分"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("包括路径信息部分"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("， 在服务器级的"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("httpd"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),t._v("conf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("和目录级的"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),t._v("htaccess"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("配置都有效， 还可以生成最终请求串。此重写操作的结果可以是内部子处理，也可以是外部请求的转向， 甚至还可以是内部代理处理。\n")])])]),s("p",[t._v("总之，两项的目的都是为了对上传的**.htaccess**能够顺利执行打开通道，但是真正有多少开发会给你开这个。。。。")]),t._v(" "),s("h2",{attrs:{id:"三、讲讲黑名单绕过-3-10"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#三、讲讲黑名单绕过-3-10"}},[t._v("#")]),t._v(" 三、讲讲黑名单绕过（3-10）")]),t._v(" "),s("p",[t._v("源码：")]),t._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$deny_ext")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("array")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" \t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//黑名单")]),t._v("\n     \n     "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$file_name")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("str_ireplace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$deny_ext")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string double-quoted-string"}},[t._v('""')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$file_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//若含黑名单，替换空")]),t._v("\n     \n     "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$file_name")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("deldot")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$file_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//删除文件名末尾的点")]),t._v("\n     \n     "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$file_ext")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("strrchr")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$file_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'.'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//截取后缀，例：.php")]),t._v("\n     \n     "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$file_ext")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("strtolower")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$file_ext")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//转换为小写")]),t._v("\n     \n     "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$file_ext")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("str_ireplace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'::$DATA'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("''")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$file_ext")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//去除字符串::$DATA")]),t._v("\n     \n     "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$file_ext")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("trim")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$file_ext")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//收尾去空")]),t._v("\n")])])]),s("p",[t._v("都有啥？")]),t._v(" "),s("p",[t._v("1.点绕过：")]),t._v(" "),s("p",[t._v("后缀加点，利用windows文件命名（"),s("strong",[t._v("后缀后加点默认不予以识别")]),t._v("）")]),t._v(" "),s("p",[t._v("2.大小写")]),t._v(" "),s("p",[t._v("改变后缀大小写，绕过黑名单")]),t._v(" "),s("p",[t._v("3.利用后缀加空格")]),t._v(" "),s("p",[t._v("4.::$DATA")]),t._v(" "),s("p",[t._v("在window的时候如果文件名+"),s("code",[t._v('"::$DATA"')]),t._v("会把"),s("code",[t._v("::$DATA")]),t._v("之后的数据当成文件流处理,不会检测后缀名，且保持"),s("code",[t._v("::$DATA")]),t._v("之前的文件名，他的目的就是"),s("strong",[t._v("不检查后缀名")])]),t._v(" "),s("p",[t._v("5.双写：")]),t._v(" "),s("p",[t._v("绕过"),s("strong",[t._v("str_ireplace")]),t._v("(),后缀：.pphphp")]),t._v(" "),s("p",[t._v("6.可直接怼的绕过：")]),t._v(" "),s("h4",{attrs:{id:"点-空格-点绕过"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#点-空格-点绕过"}},[t._v("#")]),t._v(" 点+空格+点绕过")]),t._v(" "),s("h2",{attrs:{id:"四、白名单绕过"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#四、白名单绕过"}},[t._v("#")]),t._v(" 四、白名单绕过")]),t._v(" "),s("h4",{attrs:{id:"_00截断的代码解析-特别注意-php版本需要-5-3-4-且magic-quotes-gpc置off"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_00截断的代码解析-特别注意-php版本需要-5-3-4-且magic-quotes-gpc置off"}},[t._v("#")]),t._v(" %00截断的代码解析 ==特别注意，php版本需要<5.3.4，且magic_quotes_gpc置off==")]),t._v(" "),s("p",[t._v("upload（12）get请求")]),t._v(" "),s("p",[t._v("​\t\t\t\t13 \tpost请求：POST不会像GET对%00进行自动解码，所以需要在==二进制==中进行修改，新版的bp需要在抓包之后发送至Decoder改包，再放回Reapeader")]),t._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token php language-php"}},[s("span",{pre:!0,attrs:{class:"token delimiter important"}},[t._v("<?php")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$is_upload")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant boolean"}},[t._v("false")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$msg")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("isset")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$_POST")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'submit'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$ext_arr")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("array")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'jpg'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'png'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'gif'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//白名单")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$file_ext")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("substr")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$_FILES")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'upload_file'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'name'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("strrpos")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$_FILES")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'upload_file'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'name'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string double-quoted-string"}},[t._v('"."')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//读取上传文件的后缀")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("in_array")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$file_ext")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$ext_arr")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//判断是否符合白名单")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$temp_file")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$_FILES")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'upload_file'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'tmp_name'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//获取上传文件名（无后缀）")]),t._v("\n\t\t\n\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//最关键的一步：将save_path的值提取（默认为../upload/）中间拼接了一个随机数和年月日时分秒再.上传文件的后缀")]),t._v("\n\t\t\n\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//exp:\t$img_path='../upload//9520220401035448.jpg'")]),t._v("\n\t\t\n        "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$img_path")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$_GET")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'save_path'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token string double-quoted-string"}},[t._v('"/"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("rand")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("99")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("date")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string double-quoted-string"}},[t._v('"YmdHis"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token string double-quoted-string"}},[t._v('"."')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$file_ext")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("move_uploaded_file")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$temp_file")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$img_path")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$is_upload")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$msg")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'上传出错！'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\t\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//不在白名单的后缀返回：")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$msg")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string double-quoted-string"}},[t._v('"只允许上传.jpg|.png|.gif类型文件！"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token delimiter important"}},[t._v("?>")])]),t._v("\n")])])]),s("blockquote",[s("p",[t._v("%00截断在哪截断？")]),t._v(" "),s("p",[t._v("在默认传POST请求中，我们看到传了"),s("strong",[t._v("save_path")]),t._v(",结合上面的代码注释，在save_path=../upload/11.php**%00**做处理")])]),t._v(" "),s("blockquote",[s("p",[t._v("截断原理就是%00置空，将后面的内容忽略，所以原来的：")]),t._v(" "),s("p",[t._v("$img_path='../upload//9520220401035448.jpg'在加了截断之后就可以变成：")]),t._v(" "),s("p",[t._v("$img_path='../upload//11.php")]),t._v(" "),s("p",[t._v("此时直接连接就行")])]),t._v(" "),s("p",[t._v("对于不同格式的00截断，网上都有不同的教程")]),t._v(" "),s("p",[t._v("贴上抓jpg包的结果：")]),t._v(" "),s("p",[s("img",{attrs:{src:"http://wangdengdeng.oss-cn-hangzhou.aliyuncs.com/img/image-20220401120949538.png",alt:"image-20220401120949538"}})]),t._v(" "),s("h2",{attrs:{id:"五、图片码绕过"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#五、图片码绕过"}},[t._v("#")]),t._v(" 五、图片码绕过")]),t._v(" "),s("p",[t._v("源码：")]),t._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function-definition function"}},[t._v("getReailFileType")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$filename")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$file")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fopen")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$filename")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string double-quoted-string"}},[t._v('"rb"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//二进制只读")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$bin")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fread")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$file")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//读2字节")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fclose")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$file")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$strInfo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" @"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("unpack")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string double-quoted-string"}},[t._v('"C2chars"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$bin")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//解包，解包为对应ASCII")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$typeCode")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("intval")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$strInfo")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'chars1'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$strInfo")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'chars2'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("   "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//打印ascii")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$fileType")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("''")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("    \n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("switch")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$typeCode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//对应ASCII查找")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("255216")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("            \n            "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$fileType")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'jpg'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("break")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("13780")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("            \n            "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$fileType")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'png'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("break")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("        \n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7173")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("            \n            "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$fileType")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'gif'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("break")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("            \n            "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$fileType")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'unknown'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("    \n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$fileType")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h3",{attrs:{id:"绕过方法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#绕过方法"}},[t._v("#")]),t._v(" 绕过方法：")]),t._v(" "),s("p",[t._v("写图片马：")]),t._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[t._v("copy "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("001.")]),t._v("jpeg"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("b "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" test"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),t._v("php"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("a "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2.")]),t._v("jpg\n    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("a 表明"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("ASCII")]),t._v("文本文件\n\n\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("b 表明二进制文件\n\n\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("d 允许将复制的加密文件在目标处作为解密文件保存\n\n\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("v 表示验证是否正确写入新文件\n\n\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("n 在复制名字超过"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),t._v("个字符，或者文件扩展名超过"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("个字符的文件时，使用短文件名（如果有的话）\n\n\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("y 禁止确认要覆盖现存的目标文件\n\n\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("y 提示确认要覆盖现存的目标文件\n\n\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("z 在重启模式中复制网络文件\n")])])]),s("p",[t._v("文件包含的URL：")]),t._v(" "),s("p",[t._v("http://192.168.188.130/upload-labs/include.php?file=upload/8520220403131502.png")]),t._v(" "),s("h4",{attrs:{id:"俩个函数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#俩个函数"}},[t._v("#")]),t._v(" 俩个函数：")]),t._v(" "),s("p",[s("strong",[t._v("getimagesize()")])]),t._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token php language-php"}},[s("span",{pre:!0,attrs:{class:"token delimiter important"}},[t._v("<?php")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("list")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$width")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$height")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$type")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$attr")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getimagesize")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string double-quoted-string"}},[t._v('"1.jpg"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string double-quoted-string"}},[t._v('"宽度为："')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$width")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string double-quoted-string"}},[t._v('"高度为："')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$height")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string double-quoted-string"}},[t._v('"类型为："')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$type")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string double-quoted-string"}},[t._v('"属性："')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$attr")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\t\n"),s("span",{pre:!0,attrs:{class:"token delimiter important"}},[t._v("?>")])]),t._v("\n")])])]),s("blockquote",[s("p",[t._v("​\t索引 2 给出的是图像的类型，返回的是数字，其中1 = GIF，2 = JPG，3 = PNG，4 = SWF，5 = PSD，6 = BMP，7 = TIFF(intel byte order)，8 = TIFF(motorola byte order)，9 = JPC，10 = JP2，11 = JPX，12 = JB2，13 = SWC，14 = IFF，15 = WBMP，16 = XBM")])]),t._v(" "),s("p",[s("strong",[t._v("exif_imagetype()")])]),t._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token php language-php"}},[s("span",{pre:!0,attrs:{class:"token delimiter important"}},[t._v("<?php")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$pic")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("exif_imagetype")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string double-quoted-string"}},[t._v('"1.jpg"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$pic")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token delimiter important"}},[t._v("?>")])]),t._v("\n")])])]),s("p",[s("img",{attrs:{src:"http://wangdengdeng.oss-cn-hangzhou.aliyuncs.com/img/image-20220405082346684.png",alt:"image-20220405082346684"}})]),t._v(" "),s("h2",{attrs:{id:"六、文件头识别汇总"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#六、文件头识别汇总"}},[t._v("#")]),t._v(" 六、文件头识别汇总：")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",{staticStyle:{"text-align":"center"}},[t._v("jpg")]),t._v(" "),s("th",{staticStyle:{"text-align":"center"}},[t._v("FF D8 FF (E0(FE))")])])]),t._v(" "),s("tbody",[s("tr",[s("td",{staticStyle:{"text-align":"center"}},[s("strong",[t._v("gif")])]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[s("strong",[t._v("47 49 46 38  (37 61)")])])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[s("strong",[t._v("png")])]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[s("strong",[t._v("89 50 4E 47 0D 0A 1A 0A")])])])])]),t._v(" "),s("h2",{attrs:{id:"七、二次渲染"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#七、二次渲染"}},[t._v("#")]),t._v(" 七、二次渲染")]),t._v(" "),s("p",[t._v("在文件上传之后，含有马的图片将会被打乱保存，此时马就被杀掉了，所以就需要直接制作免杀马")]),t._v(" "),s("p",[t._v("GIF：对比上传前后的图片，进行不变部分的修改")]),t._v(" "),s("p",[t._v("PNG：建议不要尝试，无底洞！")]),t._v(" "),s("p",[t._v("jpg：某人（我不知道是哪里的人）贴了代码")]),t._v(" "),s("p",[t._v("放链接了，不写了，png太TM悲伤。。。")]),t._v(" "),s("p",[t._v("http://t.csdn.cn/Nr9Ao")]),t._v(" "),s("h2",{attrs:{id:"八、条件竞争"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#八、条件竞争"}},[t._v("#")]),t._v(" 八、条件竞争")]),t._v(" "),s("p",[t._v("因为直接跑崩了虚拟机以及我的phpstudy，深恶痛绝，贴上大佬文章，真的不想再做了")]),t._v(" "),s("p",[t._v("http://t.csdn.cn/Alvb")]),t._v(" "),s("p",[t._v("至此upload-labs告一段落")])],1)}),[],!1,null,null,null);s.default=e.exports}}]);